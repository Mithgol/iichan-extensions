(()=>{"use strict";const e=50,t="iichan_hidden_threads",n="iichan-hide-thread-btn",d="iichan-thread-hidden",i="iichan-hidden-thread-placeholder",c=window.location.href.match(/(?:\w+\.\w+\/)(.*)(?=\/)/)[1],o=()=>{const e=JSON.parse(window.localStorage.getItem(t)||"{}");return Array.isArray(e)?{}:e},r=e=>{window.localStorage.setItem(t,JSON.stringify(e))},a=(e,t)=>{const n=o();if(n[c]||(n[c]=[]),t)n[c].includes(e)||n[c].push(e);else{const t=n[c].indexOf(e);if(t===-1)return;n[c].splice(t,1)}r(n)},s=e=>{if(e){const t=e.querySelector(":scope > label");if(t){const d=document.createElement("span");d.title="Скрыть тред",d.classList.add(n),d.dataset.threadId=e.id,d.addEventListener("click",m),e.insertBefore(d,t.nextSibling)}}},l=e=>{if(e){const t=document.createElement("div");t.title="Скрыть тред",t.classList.add(n,"reply"),t.dataset.threadId=e.id,t.addEventListener("click",p),e.querySelector(".catthread").appendChild(t)}},u=t=>{if(t){const n=t.id.split("-").pop();let d=t.querySelector(".filetitle").innerText||t.querySelector("blockquote").innerText;d=d.substr(0,e);const c="iichan-hidden-"+t.id;t.insertAdjacentHTML("beforebegin",`
      <div class="reply ${i}" id="${c}">Тред <a>№${n}</a> скрыт (${d||"изображение"})</div>
    `);const o=t.previousElementSibling.querySelector(":scope > a");o.dataset.threadId=t.id,o.addEventListener("click",f)}},h=e=>{const t=!!document.querySelector(".catthreadlist"),n=t?".catthreadlist a":"[id^=thread]",d=e&&e.id.startsWith("thread-")?[e]:(e||document).querySelectorAll(n),i=t?l:s,r=o();for(const a of d)a.id=t?"thread-"+a.title.match(/^#(\d+)\s/)[1]:a.id,i(a),r[c]&&r[c].includes(a.id)&&m(a.id)},f=e=>{const t=e.target?e.target.dataset.threadId:e;a(t,!1);const n=document.getElementById(t);if(n){n.classList.remove(d);const e=document.getElementById("iichan-hidden-"+t);e&&e.parentElement.removeChild(e)}},m=e=>{const t=e.target?e.target.dataset.threadId:e;a(t,!0);const n=document.getElementById(t);if(n&&n.parentNode){n.classList.add(d);const e=!!document.querySelector(".catthreadlist");e||u(n)}},p=e=>{const t=e.target?e.target.dataset.threadId:e,n=t.split("-").pop(),i=document.getElementById("thread-"+n);a(t,i.classList.toggle(d)),e.preventDefault&&e.preventDefault()},y=()=>{document.head.insertAdjacentHTML("beforeend",`<style type="text/css">
        .${i} {
            pointer-events: none;
        }
        
        .${i} a {
            cursor: pointer;
            pointer-events: auto;
        }
        
        .${i}:hover + div,
        .${i}:hover + div + br {
            display: block !important;
        }
        
        .${i} + div {
            display: none;
        }
        .${i} + div +  br {
            display: none;
        }
        
        .${n} {
            margin-left: 0.2em;
            cursor: pointer;
        }
        
        .${n}::after {
            content: '[✕]';
        }
        
        .catthreadlist a {
          position: relative;
          transition: all .3s ease-in-out;
        }
        
        .catthreadlist .iichan-thread-hidden {
          opacity: .6;
        }
        
        .catthreadlist .iichan-thread-hidden:not(:hover) {
          opacity: .2;
          filter: blur(1px);
        }
        
        .catthread:hover .${n} {
          display: block;
        }
        
        .catthread .${n} {
          text-decoration: none;
          position: absolute;
          top: 0;
          right: 0;
          display: none;
          width: 25px;
          height: 25px;
        }
        
        .catthreadlist .iichan-thread-hidden .${n}::after {
          content: '[┼]';
        }
      </style>`)},g=()=>{if(!document.querySelector("#de-main")&&!document.querySelector("body.replypage")){y(),h();const e=new MutationObserver(e=>{e.forEach(e=>{for(const t of e.addedNodes){if(!t.querySelectorAll)return;h(t)}})});e.observe(document.body,{childList:!0,subtree:!0})}};document.body?g():document.addEventListener("DOMContentLoaded",g)})();